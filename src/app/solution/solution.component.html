<ng-container *ngIf="vm$ | async as vm">
  <div class="flex flex-col mx-6 justify-center max-w-screen-md md:mx-auto border-x border-dashed">
    @if (vm.solutionResponse?.solution; as solution) {
      @if (solution && solution.name) {
        <h2 class="font-semibold text-gray-800 text-2xl mb-2 p-3 pt-24 first-letter:capitalize">
          {{ convertKeyToLowercase('name', solution) }}
        </h2>
      }
      <div class="relative mb-4 h-auto w-full aspect-video">
        @if (solution.images.length === 0) {
          <img
            ngSrc="assets/images/default-placeholder.png"
            alt="hero"
            class="object-cover transition-opacity duration-300"
            fill />
        } @else {
          @for (image of solution.images; track $index) {
            <img
              [ngClass]="$index === currentImageIndex ? 'opacity-100' : 'opacity-0'"
              [ngSrc]="displayImage(image)"
              alt="hero"
              class="object-cover transition-opacity duration-300"
              fill />
          }
          @if (solution.images.length > 1) {
            <button
              class="absolute top-1/2 -left-10 p-2 rounded-full bg-green-300 shadow-lg cursor-pointer disabled:bg-green-300/60 disabled:cursor-not-allowed"
              [disabled]="isFirstImage()"
              (click)="prevImage()">
              <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-arrow-left h-4 w-4 fill-black" viewBox="0 0 16 16">
                <path
                  fill-rule="evenodd"
                  d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
              </svg>
            </button>

            <button
              [disabled]="isLastImage(solution.images)"
              class="absolute top-1/2 -right-10 p-2 rounded-full bg-green-300 shadow-lg cursor-pointer disabled:bg-green-300/60 disabled:cursor-not-allowed"
              (click)="nextImage(solution.images)">
              <svg xmlns="http://www.w3.org/2000/svg" class="bi bi-arrow-right h-4 w-4 fill-black" viewBox="0 0 16 16">
                <path
                  fill-rule="evenodd"
                  d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
              </svg>
            </button>
          }
        }
      </div>

      <div class="p-4">
        <p class="mb-6 hyphens-auto first-letter:capitalize">{{ convertKeyToLowercase('description', solution) }}</p>
        <h2 class="font-semibold text-gray-800 text-2xl mb-2">Problème résolu</h2>
        <p class="mb-6 hyphens-auto first-letter:capitalize">
          {{ convertKeyToLowercase('targeted_problem', solution) }}
        </p>
        <h2 class="font-semibold text-2xl mb-2">Innovateur</h2>
        <p class="">{{ solution.user.name }} &mdash; {{ solution.user.email }}</p>
        <p class="">
          {{ solution.thematic.name }}
        </p>
        <div class="mb-6">
          @for (challenge of solution.challenges; track challenge.id) {
            <p class="mr-2">&mdash; {{ challenge.name }}</p>
          }
        </div>
      </div>
      <div class="flex justify-between mb-8 pt-8 px-4 md:px-8 border-t">
        @if (vm.solutionResponse?.prev; as prev) {
          <button
            [disabled]="!prev"
            (click)="load(prev)"
            class="font-medium text-sm flex items-center text-black bg-green-400/70 rounded-md px-6 py-2 justify-center gap-1 disabled:text-gray-600 disabled:cursor-not-allowed">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              class="bi bi-chevron-double-left w-3 h-3"
              viewBox="0 0 16 16">
              <path
                fill-rule="evenodd"
                d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
              <path
                fill-rule="evenodd"
                d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
            </svg>
            Précédent
          </button>
        }
        @if (vm.solutionResponse?.next; as next) {
          <button
            [disabled]="!next"
            (click)="load(next)"
            class="font-medium text-sm flex items-center text-black bg-green-400/70 rounded-md px-6 py-2 justify-center gap-1 disabled:text-gray-600 disabled:cursor-not-allowed">
            Suivant
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              class="bi bi-chevron-double-right w-3 h-3"
              viewBox="0 0 16 16">
              <path
                fill-rule="evenodd"
                d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708" />
              <path
                fill-rule="evenodd"
                d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708" />
            </svg>
          </button>
        }
      </div>
    }
    @if (vm.isLoading) {
      <div class="h-screen flex flex-col items-center gap-4 justify-center">
        <app-spinner class="text-green-400" />
        En cours de chargement...
      </div>
    }
    @if (!vm.isLoading && !vm.solutionResponse?.solution) {
      <div class="h-screen flex flex-col items-center gap-4 justify-center">
        <h4>Aucune solution trouvée</h4>
        <p class="text-4xl font-bondiMono font-black">404</p>
        <a routerLink="/solutions" class="text-base inline-block text-green-400">Voir toutes les solutions</a>
      </div>
    }
  </div>
</ng-container>
